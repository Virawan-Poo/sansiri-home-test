name: Generate & Commit HTML Pages

# ‡∏£‡∏≠ event ‡∏à‡∏≤‡∏Å n8n (repository_dispatch)
on:
  repository_dispatch:
    types: [generate-pages]

jobs:
  build-and-commit:
    runs-on: ubuntu-latest

    steps:
      # 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Node.js ‡πÅ‡∏•‡∏∞ dependencies
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      # 3. ‡πÄ‡∏ã‡∏ü payload ‡∏à‡∏≤‡∏Å n8n (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ)
      - name: Save payload
        run: |
          cat << 'EOF' > data.json
          ${{ toJson(github.event.client_payload.data) }}
          EOF

      # 4. ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå generateHTML
      - name: Run render.js
        run: node render.js

      # 5. Commit ‡πÅ‡∏•‡∏∞ Push ‡∏´‡∏ô‡πâ‡∏≤ HTML ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
      - name: Commit generated pages
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add pages/
          git commit -m "üîÑ Generate HTML pages via GitHub Actions"
          git push
        env:
          # ‡∏à‡∏∞‡πÉ‡∏ä‡πâ token ‡∏ó‡∏µ‡πà GitHub ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
